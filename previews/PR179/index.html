<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Libtask · Libtask</title><meta name="title" content="Libtask · Libtask"/><meta property="og:title" content="Libtask · Libtask"/><meta property="twitter:title" content="Libtask · Libtask"/><meta name="description" content="Documentation for Libtask."/><meta property="og:description" content="Documentation for Libtask."/><meta property="twitter:description" content="Documentation for Libtask."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>Libtask</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Libtask</a></li><li><a class="tocitem" href="internals/">Internals</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Libtask</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Libtask</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/TuringLang/Libtask.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/TuringLang/Libtask.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Libtask"><a class="docs-heading-anchor" href="#Libtask">Libtask</a><a id="Libtask-1"></a><a class="docs-heading-anchor-permalink" href="#Libtask" title="Permalink"></a></h1><p>Libtask is best explained by the docstring for <a href="#Libtask.TapedTask"><code>TapedTask</code></a>:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Libtask.TapedTask" href="#Libtask.TapedTask"><code>Libtask.TapedTask</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">TapedTask(dynamic_scope::Any, f, args...)</code></pre><p>Construct a <code>TapedTask</code> with the specified <code>dynamic_scope</code>, for function <code>f</code> and positional arguments <code>args</code>.</p><p><strong>Extended Help</strong></p><p>There are three central features of a <code>TapedTask</code>, which we demonstrate via three examples.</p><p><strong>Resumption</strong></p><p>The function <a href="#Libtask.produce"><code>Libtask.produce</code></a> has a special meaning in Libtask. You can insert it into regular Julia functions anywhere that you like. For example</p><pre><code class="language-julia-repl hljs">julia&gt; function f()
           for t in 1:2
               produce(t)
               t += 1
           end
           return nothing
       end
f (generic function with 1 method)</code></pre><p>If you construct a <code>TapedTask</code> from <code>f</code>, and call <a href="#Libtask.consume"><code>Libtask.consume</code></a> on it, you&#39;ll see</p><pre><code class="language-julia-repl hljs">julia&gt; t = TapedTask(nothing, f);

julia&gt; consume(t)
1</code></pre><p>The semantics of this are that <a href="#Libtask.consume"><code>Libtask.consume</code></a> runs the function <code>f</code> until it reaches the call to <a href="#Libtask.produce"><code>Libtask.produce</code></a>, at which point it will return the argument to <a href="#Libtask.produce"><code>Libtask.produce</code></a>.</p><p>Subsequent calls to <a href="#Libtask.produce"><code>Libtask.produce</code></a> will <em>resume</em> execution of <code>f</code> immediately after the last <a href="#Libtask.produce"><code>Libtask.produce</code></a> statement that was hit.</p><pre><code class="language-julia-repl hljs">julia&gt; consume(t)
2</code></pre><p>When there are no more <a href="#Libtask.produce"><code>Libtask.produce</code></a> statements to hit, calling <a href="#Libtask.consume"><code>Libtask.consume</code></a> will return <code>nothing</code>:</p><pre><code class="language-julia-repl hljs">julia&gt; consume(t)
</code></pre><p><strong>Copying</strong></p><p><a href="#Libtask.TapedTask"><code>TapedTask</code></a>s can be copied. Doing so creates a completely independent object. For example:</p><pre><code class="language-julia-repl hljs">julia&gt; t2 = TapedTask(nothing, f);

julia&gt; consume(t2)
1</code></pre><p>If we make a copy and advance its state, it produces the same value that the original would have produced:</p><pre><code class="language-julia-repl hljs">julia&gt; t3 = copy(t2);

julia&gt; consume(t3)
2</code></pre><p>Moreover, advancing the state of the copy has not advanced the state of the original, because they are completely independent copies:</p><pre><code class="language-julia-repl hljs">julia&gt; consume(t2)
2</code></pre><p><strong>Scoped Values</strong></p><p>It is often desirable to permit a copy of a task and the original to differ in very specific ways. For example, in the context of Sequential Monte Carlo, you might want the only difference between two copies to be their random number generator.</p><p>A generic mechanism is available to achieve this. <a href="#Libtask.get_dynamic_scope"><code>Libtask.get_dynamic_scope</code></a> and <a href="#Libtask.set_dynamic_scope!"><code>Libtask.set_dynamic_scope!</code></a> let you set and retrieve a variable which is specific to a given <a href="#Libtask.TapedTask"><code>Libtask.TapedTask</code></a>. The former can be called inside a function:</p><pre><code class="language-julia-repl hljs">julia&gt; function f()
           produce(get_dynamic_scope())
           produce(get_dynamic_scope())
           return nothing
       end
f (generic function with 1 method)</code></pre><p>The first argument to <a href="#Libtask.TapedTask"><code>Libtask.TapedTask</code></a> is the value that <a href="#Libtask.get_dynamic_scope"><code>Libtask.get_dynamic_scope</code></a> will return:</p><pre><code class="language-julia-repl hljs">julia&gt; t = TapedTask(1, f);

julia&gt; consume(t)
1</code></pre><p>The value that it returns can be changed between <a href="#Libtask.consume"><code>Libtask.consume</code></a> calls:</p><pre><code class="language-julia-repl hljs">julia&gt; set_dynamic_scope!(t, 2)

julia&gt; consume(t)
2</code></pre><p><code>Int</code>s have been used here, but it is permissible to set the value returned by <a href="#Libtask.get_dynamic_scope"><code>Libtask.get_dynamic_scope</code></a> to anything you like.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/Libtask.jl/blob/d41ad7b70fca2f74f78c5b0264a30687776f77ee/src/copyable_task.jl#L49-L164">source</a></section></article><p>The functions discussed the above docstring (in addition to <a href="#Libtask.TapedTask"><code>TapedTask</code></a> itself) form the public interface of Libtask.jl. They divide neatly into two kinds of functions: those which are used to manipulate <a href="#Libtask.TapedTask"><code>TapedTask</code></a>s, and those which are intended to be used <em>inside</em> a <a href="#Libtask.TapedTask"><code>TapedTask</code></a>. First, manipulation of <a href="#Libtask.TapedTask"><code>TapedTask</code></a>s:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Libtask.consume" href="#Libtask.consume"><code>Libtask.consume</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">consume(t::TapedTask)</code></pre><p>Run <code>t</code> until it makes a call to <code>produce</code>. If this is the first time that <code>t</code> has been called, it start execution from the entry point. If <code>consume</code> has previously been called on <code>t</code>, it will resume from the last <code>produce</code> call. If there are no more <code>produce</code> calls, <code>nothing</code> will be returned.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/Libtask.jl/blob/d41ad7b70fca2f74f78c5b0264a30687776f77ee/src/copyable_task.jl#L193-L200">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.copy-Tuple{TapedTask}" href="#Base.copy-Tuple{TapedTask}"><code>Base.copy</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Base.copy(t::TapedTask)</code></pre><p>Makes a completely independent copy of <code>t</code>. <code>consume</code> can be applied to either the copy of <code>t</code> or the original without advancing the state of the other.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/Libtask.jl/blob/d41ad7b70fca2f74f78c5b0264a30687776f77ee/src/copyable_task.jl#L185-L190">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Libtask.set_dynamic_scope!" href="#Libtask.set_dynamic_scope!"><code>Libtask.set_dynamic_scope!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">set_dynamic_scope!(t::TapedTask, new_dynamic_scope)::Nothing</code></pre><p>Set the <code>dynamic_scope</code> of <code>t</code> to <code>new_dynamic_scope</code>. Any references to  <code>LibTask.dynamic_scope</code> in future calls to <code>consume(t)</code> (either directly, or implicitly via iteration) will see this new value.</p><p>See also: <a href="#Libtask.get_dynamic_scope"><code>get_dynamic_scope</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/Libtask.jl/blob/d41ad7b70fca2f74f78c5b0264a30687776f77ee/src/copyable_task.jl#L171-L179">source</a></section></article><p>Functions for use inside a <a href="#Libtask.TapedTask"><code>TapedTask</code></a>s are:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Libtask.produce" href="#Libtask.produce"><code>Libtask.produce</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">produce(x)</code></pre><p>When run inside a <a href="#Libtask.TapedTask"><code>TapedTask</code></a>, will immediately yield to the caller, producing value <code>x</code>.</p><p>See also: <a href="#Libtask.consume"><code>Libtask.consume</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/Libtask.jl/blob/d41ad7b70fca2f74f78c5b0264a30687776f77ee/src/copyable_task.jl#L15-L22">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Libtask.get_dynamic_scope" href="#Libtask.get_dynamic_scope"><code>Libtask.get_dynamic_scope</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">get_dynamic_scope()</code></pre><p>Returns the dynamic scope associated to <code>Libtask</code>. If called from inside a <code>TapedTask</code>, this will return whatever is contained in its <code>dynamic_scope</code> field.</p><p>See also <a href="#Libtask.set_dynamic_scope!"><code>set_dynamic_scope!</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/TuringLang/Libtask.jl/blob/d41ad7b70fca2f74f78c5b0264a30687776f77ee/src/copyable_task.jl#L3-L10">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="internals/">Internals »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Thursday 13 March 2025 12:49">Thursday 13 March 2025</span>. Using Julia version 1.11.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
